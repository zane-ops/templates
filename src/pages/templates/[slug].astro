---
export const prerender = true;

import StarlightPage from "@astrojs/starlight/components/StarlightPage.astro";
import { Code } from "astro:components";
import { getCollection } from "astro:content";
import { readFileSync } from "node:fs";
import { dirname, resolve } from "node:path";
import { fileURLToPath } from "node:url";

export async function getStaticPaths() {
	const templates = await getCollection("templates");
	return templates.map((entry) => ({
		params: { slug: entry.data.slug },
		props: { entry },
	}));
}

const { entry } = Astro.props;
const { name, description, tags } = entry.data;

// src/pages/templates/ → ../../ → src/ → content/templates/[slug]/compose.yml
const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);
const ymlPath = resolve(
	__dirname,
	"../../content/templates",
	entry.data.slug,
	"compose.yml",
);
const yamlContent = readFileSync(ymlPath, "utf-8");
---

<StarlightPage frontmatter={{ title: name, description, template: "splash" }}>
	<p>{description}</p>
	<ul>
		{tags.map((tag) => <li>{tag}</li>)}
	</ul>
	<Code code={yamlContent} lang="yaml" />
</StarlightPage>
